!function(r){var t={};function s(e){if(t[e])return t[e].exports;var a=t[e]={i:e,l:!1,exports:{}};return r[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=r,s.c=t,s.d=function(e,a,r){s.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(a,e){if(1&e&&(a=s(a)),8&e)return a;if(4&e&&"object"==typeof a&&a&&a.__esModule)return a;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:a}),2&e&&"string"!=typeof a)for(var t in a)s.d(r,t,function(e){return a[e]}.bind(null,t));return r},s.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(a,"a",a),a},s.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},s.p="",s(s.s=0)}([function(e,a,r){"use strict";r(1);var t,s=r(2),n=(t=s)&&t.__esModule?t:{default:t};H5P.Dialogcards=n.default},function(e,a,r){},function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=n(r(3)),s=n(r(7));function n(e){return e&&e.__esModule?e:{default:e}}var l=H5P.jQuery,i=H5P.JoubelUI,d=function(e){function o(e,a,r){!function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,o);var c=function(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return c.contentId=c.id=a,c.contentData=r||{},c.params=l.extend({title:"",mode:"normal",description:"Sit in pairs and make up sentences where you include the expressions below.<br/>Example: I should have said yes, HOWEVER I kept my mouth shut.",next:"Next",prev:"Previous",retry:"Retry",answer:"Turn",correctAnswer:"I got it right!",incorrectAnswer:"I got it wrong",round:"Round @round",cardsLeft:"Cards left: @number",nextRound:"Proceed to round @round",showSummary:"Next",summary:"Summary",summaryCardsRight:"Cards you got right:",summaryCardsWrong:"Cards you got wrong:",summaryCardsNotShown:"Cards in pool not shown:",summaryOverallScore:"Overall Score",summaryCardsCompleted:"Cards you have completed learning:",summaryCompletedRounds:"Completed rounds:",summaryAllDone:"Well done! You got all @cards cards correct @max times in a row each!",progressText:"Card @card of @total",cardFrontLabel:"Card front",cardBackLabel:"Card back",tipButtonLabel:"Show tip",audioNotSupported:"Your browser does not support this audio",dialogs:[{text:"Horse",answer:"Hest"},{text:"Cow",answer:"Ku"}],behaviour:{enableRetry:!0,disableBackwardsNavigation:!1,scaleTextNotCard:!1,randomCards:!1,maxProficiency:5,quickProgression:!1}},e),c.cards=[],c.currentCardId=0,c.round=0,c.results=[],c.attach=function(e){c.$inner=e.addClass("h5p-dialogcards"),c.params.behaviour.scaleTextNotCard&&e.addClass("h5p-text-scaling");var a={mode:c.params.mode,dialogs:c.params.dialogs,audioNotSupported:c.params.audioNotSupported,answer:c.params.answer,showSummary:c.params.showSummary,incorrectAnswer:c.params.incorrectAnswer,correctAnswer:c.params.correctAnswer,progressText:c.params.progressText,tipButtonLabel:c.params.tipButtonLabel,behaviour:{scaleTextNotCard:c.params.behaviour.scaleTextNotCard,maxProficiency:c.params.behaviour.maxProficiency,quickProgression:c.params.behaviour.quickProgression}};c.cardManager=new t.default(a,c.id,{onCardTurned:c.handleCardTurned,onNextCard:c.nextCard}),c.createDOM(0===c.round),c.updateNavigation(),c.trigger("resize")},c.createDOM=function(e){if(c.cardIds=c.cardManager.createSelection(),c.cardPoolSize=c.cardPoolSize||c.cardIds.length,!0===e){var a=l("<div>"+c.params.title+"</div>").text().trim();c.$header=l((a?'<div class="h5p-dialogcards-title"><div class="h5p-dialogcards-title-inner">'+c.params.title+"</div></div>":"")+'<div class="h5p-dialogcards-description">'+c.params.description+"</div>"),c.summaryScreen=new s.default(c.params,{nextRound:c.nextRound,retry:c.restartRepetition})}!0===e?c.$cardwrapperSet=c.initCards(c.cardIds):(c.$cardwrapperSet.remove(),c.$cardwrapperSet=c.initCards(c.cardIds),c.$cardSideAnnouncer.before(c.$cardwrapperSet)),c.$cardwrapperSet.prepend(c.summaryScreen.getDOM()),!0===e&&(c.$cardSideAnnouncer=l("<div>",{html:c.params.cardFrontLabel,class:"h5p-dialogcards-card-side-announcer","aria-live":"polite","aria-hidden":"true"}),c.$footer=c.createFooter(),c.$mainContent=l("<div>").append(c.$header).append(c.$cardwrapperSet).append(c.$cardSideAnnouncer).append(c.$footer).appendTo(c.$inner),c.on("reset",function(){this.reset()}),c.on("resize",c.resize),c.round=1)},c.createFooter=function(){var e=l("<nav>",{class:"h5p-dialogcards-footer",role:"navigation"});return"normal"===c.params.mode?(c.$prev=i.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-prev truncated","aria-label":c.params.prev,title:c.params.prev}).click(function(){c.prevCard()}).appendTo(e),c.$next=i.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-next truncated","aria-label":c.params.next,title:c.params.next}).click(function(){c.nextCard()}).appendTo(e),c.$retry=i.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-retry h5p-dialogcards-disabled","aria-title":c.params.retry,title:c.params.retry,html:c.params.retry}).click(function(){c.trigger("reset")}).appendTo(e),c.$progress=l("<div>",{class:"h5p-dialogcards-progress","aria-live":"assertive"}).appendTo(e)):(c.$round=l("<div>",{class:"h5p-dialogcards-round"}).appendTo(e),c.$progress=l("<div>",{class:"h5p-dialogcards-cards-left","aria-live":"assertive"}).appendTo(e)),e},c.updateImageSize=function(){var r=0,t=c.cards[c.currentCardId].getDOM().find(".h5p-dialogcards-card-content");if(c.params.dialogs.forEach(function(e){if(e.image){var a=e.image.height/e.image.width*t.get(0).getBoundingClientRect().width;r<a&&(r=a)}}),0<r){var a=r/parseFloat(c.$inner.css("font-size"));15<a&&(a=15),c.cards.forEach(function(e){e.getImage().parent().css("height",a+"em")})}},c.initCards=function(e){c.cards=[],c.currentCardId=0,c.params.behaviour.randomCards&&(e=H5P.shuffleArray(e));for(var a=l("<div>",{class:"h5p-dialogcards-cardwrap-set"}),r=0;r<e.length&&!(2<=r);r++){var t=c.getCard(e[r]);t.setProgressText(r+1,e.length),c.cards.push(t);var s=t.getDOM();r===c.currentCardId&&(s.addClass("h5p-dialogcards-current"),c.$current=s),t.addTipToCard(s.find(".h5p-dialogcards-card-content"),"front",r),a.append(s)}return a},c.handleCardTurned=function(e){c.$cardSideAnnouncer.html(e?c.params.cardFrontLabel:c.params.cardBackLabel),c.params.behaviour.enableRetry&&c.currentCardId+1===c.cardIds.length&&c.$retry&&(c.$retry.removeClass("h5p-dialogcards-disabled"),c.truncateRetryButton())},c.updateNavigation=function(){"normal"===c.params.mode?(c.currentCardId<c.cardIds.length-1?(c.$next.removeClass("h5p-dialogcards-disabled"),c.$retry.addClass("h5p-dialogcards-disabled")):c.$next.addClass("h5p-dialogcards-disabled"),0<c.currentCardId&&!c.params.behaviour.disableBackwardsNavigation?c.$prev.removeClass("h5p-dialogcards-disabled"):c.$prev.addClass("h5p-dialogcards-disabled"),c.$progress.text(c.params.progressText.replace("@card",c.currentCardId+1).replace("@total",c.cardIds.length)),c.cards[c.currentCardId].resizeOverflowingText()):(c.$round.text(c.params.round.replace("@round",c.round)),c.$progress.text(c.params.cardsLeft.replace("@number",c.cardIds.length-c.currentCardId))),c.trigger("resize")},c.showSummary=function(){var e=c.cardManager.updatePiles(c.results),a=c.results.filter(function(e){return!0===e.result}).length,r=c.results.length-a,t=c.cardPoolSize-a-r,s=e.slice(-1)[0],n=s===c.cardPoolSize,i={round:c.round,results:[{field:"h5p-dialogcards-round-cards-right",score:{value:a,max:r+a}},{field:"h5p-dialogcards-round-cards-wrong",score:{value:r,max:r+a}},{field:"h5p-dialogcards-round-cards-not-shown",score:{value:t}},{field:"h5p-dialogcards-overall-cards-completed",score:{value:s,max:c.cardPoolSize}},{field:"h5p-dialogcards-overall-completed-rounds",score:{value:c.round}}]};n&&(i.done=!0,i.message=c.params.summaryAllDone.replace("@cards",c.cardPoolSize).replace("@max",c.params.behaviour.maxProficiency-1)),c.summaryScreen.update(i),c.summaryScreen.show(),c.hideCards(),c.trigger("resize")},c.showCards=function(){c.$cardwrapperSet.find(".h5p-dialogcards-cardwrap").removeClass("h5p-dialogcards-gone"),c.$footer.removeClass("h5p-dialogcards-gone"),c.cardsShown=!0},c.hideCards=function(){c.$cardwrapperSet.find(".h5p-dialogcards-cardwrap").addClass("h5p-dialogcards-gone"),c.$footer.addClass("h5p-dialogcards-gone"),c.cardsShown=!1},c.nextCard=function(e){if(c.results.push(e),c.currentCardId+1!==c.cardIds.length){var a=c.cards[c.currentCardId];a.stopAudio(),a.getDOM().removeClass("h5p-dialogcards-current").addClass("h5p-dialogcards-previous"),c.currentCardId++,(a=c.cards[c.currentCardId]).getDOM().addClass("h5p-dialogcards-current"),a.setCardFocus();var r=c.currentCardId+1;if(r>=c.cards.length&&r<c.cardIds.length){var t=c.getCard(c.cardIds[r]);t.setProgressText(r+1,c.cardIds.length),c.cards.push(t);var s=t.getDOM();s.appendTo(c.$cardwrapperSet),t.addTipToCard(s.find(".h5p-dialogcards-card-content"),"front",r),c.resize()}c.updateNavigation()}else"repetition"===c.params.mode&&(c.$progress.text(c.params.cardsLeft.replace("@number",0)),c.cards[c.currentCardId].showSummaryButton(c.showSummary))},c.getCard=function(e){var a=c.cardManager.getCard(e);return a.createButtonListeners(),a},c.prevCard=function(){if(0!==c.currentCardId){var e=c.cards[c.currentCardId];e.stopAudio(),e.getDOM().removeClass("h5p-dialogcards-current"),c.currentCardId--,(e=c.cards[c.currentCardId]).getDOM().addClass("h5p-dialogcards-current").removeClass("h5p-dialogcards-previous"),e.setCardFocus(),c.updateNavigation()}},c.showAllAudio=function(){c.$cardwrapperSet.find(".h5p-audio-inner").removeClass("hide")},c.restartRepetition=function(){c.cardManager.reset(),c.round=0,c.nextRound()},c.nextRound=function(){c.round++,c.summaryScreen.hide(),c.showCards(),c.reset(),c.createDOM(),c.cards[c.currentCardId].setCardFocus(!0),c.updateNavigation(),c.trigger("resize")},c.reset=function(){c.results=[],c.cards[c.currentCardId].stopAudio(c.$current.index()),c.cards.forEach(function(e){e.reset()}),c.currentCardId=0,"normal"===c.params.mode&&c.cards[c.currentCardId].getDOM().addClass("h5p-dialogcards-current"),c.updateNavigation(),c.$retry&&c.$retry.addClass("h5p-dialogcards-disabled"),c.showAllAudio(),c.cards[c.currentCardId].resizeOverflowingText(),c.cards[c.currentCardId].setCardFocus()},c.resize=function(){var r=0;c.updateImageSize(),c.params.behaviour.scaleTextNotCard||!1===c.cardsShown||c.determineCardSizes(),c.$cardwrapperSet.css("height","auto"),c.$cardwrapperSet.children(":not(.h5p-dialogcards-gone)").each(function(){var e=l(this).css("height","initial").outerHeight();if(l(this).css("height","inherit"),r=r<e?e:r,!l(this).next(".h5p-dialogcards-cardwrap").length){var a=l(this).find(".h5p-dialogcards-cardholder").css("height","initial").outerHeight();r=r<a?a:r,l(this).find(".h5p-dialogcards-cardholder").css("height","inherit")}});var e=r/parseFloat(c.$cardwrapperSet.css("font-size"));c.$cardwrapperSet.css("height",e+"em"),c.scaleToFitHeight(),c.truncateRetryButton(),c.cards[c.currentCardId].resizeOverflowingText()},c.determineCardSizes=function(){var o=c;void 0===c.cardSizeDetermined&&(c.cardSizeDetermined=[]),c.$cardwrapperSet.children(":visible").each(function(e){if(-1===o.cardSizeDetermined.indexOf(e)){o.cardSizeDetermined.push(e);var a=l(".h5p-dialogcards-card-content",this),r=l(".h5p-dialogcards-card-text-inner-content",a),t=r[0].getBoundingClientRect().height,s=o.cards[e];s.changeText(s.getAnswer());var n=r[0].getBoundingClientRect().height,i=n<t?t:n,d=parseFloat(r.parent().parent().css("minHeight"));i<d&&(i=d),i/=parseFloat(a.css("fontSize")),r.parent().css("height",i+"em"),s.changeText(s.getText())}})},c.scaleToFitHeight=function(){if(c.$cardwrapperSet&&c.$cardwrapperSet.is(":visible")&&c.params.behaviour.scaleTextNotCard)if(c.$inner.parents(".h5p-course-presentation").length){var e=c.$inner.parent();c.$inner.parents(".h5p-popup-container").length&&(e=c.$inner.parents(".h5p-popup-container"));var a=e.get(0).getBoundingClientRect().height,r=function(){var a=0;return c.$inner.children().each(function(){var e=l(this);a+=this.getBoundingClientRect().height+parseFloat(e.css("margin-top"))+parseFloat(e.css("margin-bottom"))}),a},t=r(),s=parseFloat(c.$inner.parent().css("font-size")),n=parseFloat(c.$inner.css("font-size"));if(a<t)for(;a<t&&!((n-=o.SCALEINTERVAL)<o.MINSCALE);)c.$inner.css("font-size",n/s+"em"),t=r();else for(var i=!0;i;){if(o.MAXSCALE<(n+=o.SCALEINTERVAL)){i=!1;break}var d=n/s;c.$inner.css("font-size",d+"em"),a<=(t=r())&&(i=!1,d=(n-o.SCALEINTERVAL)/s,c.$inner.css("font-size",d+"em"))}}else c.cards[c.currentCardId].resizeOverflowingText()},c.truncateRetryButton=function(){if(c.$retry){c.$retry.removeClass("truncated"),c.$retry.html(c.params.retry);.3<(c.$retry.get(0).getBoundingClientRect().width+parseFloat(c.$retry.css("margin-left"))+parseFloat(c.$retry.css("margin-right")))/c.$retry.parent().get(0).getBoundingClientRect().width&&(c.$retry.addClass("truncated"),c.$retry.html(""))}},c.getTitle=function(){return H5P.createTitle(c.contentData&&c.contentData.metadata&&c.contentData.metadata.title?c.contentData.metadata.title:"Dialog Cards")},c}return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}(o,H5P.EventDispatcher),o}();d.SCALEINTERVAL=.2,d.MAXSCALE=16,d.MINSCALE=4,a.default=d},function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=function(){function t(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),n=t(r(4)),i=t(r(6));function t(e){return e&&e.__esModule?e:{default:e}}function d(e){if(Array.isArray(e)){for(var a=0,r=Array(e.length);a<e.length;a++)r[a]=e[a];return r}return Array.from(e)}var o=function(){function t(e,a,r){return function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e,this.cardPool=new n.default(e,a,r),this.reset(),this}return s(t,[{key:"createSelection",value:function(){var e=[];switch(this.params.mode){case"repetition":e=this.createSelectionRepetition();break;default:e=this.cardPool.getCardIds()}return e}},{key:"createPiles",value:function(){this.cardPiles=[];var e=this.cardPool.getCardIds();switch(this.params.mode){case"repetition":for(var a=0;a<this.params.behaviour.maxProficiency;a++)0===a?this.cardPiles.push(new i.default(e)):this.cardPiles.push(new i.default);break;case"normal":this.cardPiles.push(new i.default(e))}}},{key:"updatePiles",value:function(e){var t=this;return e.forEach(function(e){var a=t.find(e.cardId);if(-1!==a){var r=!0===e.result?a+1:0;r=Math.max(0,Math.min(r,t.cardPiles.length-1)),t.cardPiles[a].remove(e.cardId),t.cardPiles[r].add(e.cardId,"bottom")}}),this.cardPiles.map(function(e){return e.length()})}},{key:"createSelectionRepetition",value:function(){for(var e=[],a=null,r=0;r<this.cardPiles.length-1;r++){var t,s=this.cardPiles[r].length();if(null!==a||0!==s){null===a&&(a=r);var n=Math.ceil(1*s/(1+r-a)),i=this.cardPiles[r].peek(0,n);e=(t=e).concat.apply(t,d(i))}}return e=this.shuffle(e)}},{key:"shuffle",value:function(e){for(var a=e.slice(),r=a.length-1;0<r;r--){var t=Math.floor(Math.random()*(r+1)),s=[a[t],a[r]];a[r]=s[0],a[t]=s[1]}return a}},{key:"find",value:function(r){var t=-1;return this.cardPiles.forEach(function(e,a){if(-1!==t)return t;e.contains(r)&&(t=a)}),t}},{key:"reset",value:function(){this.createPiles()}},{key:"getCard",value:function(e){return this.cardPool.getCard(e)}}]),t}();a.default=o},function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t,n=function(){function t(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),s=r(5),i=(t=s)&&t.__esModule?t:{default:t};var d=function(){function s(e,a,r){var t=this;return function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,s),this.params=e,this.contentId=a,this.callbacks=r,this.cards=[],this.params.dialogs.forEach(function(e,a){e.id=a,t.cards.push(a)}),this}return n(s,[{key:"getCard",value:function(e){if(!(e<0||e>this.cards.length))return"number"==typeof this.cards[e]&&this.loadCard(e),this.cards[e]}},{key:"getCardIds",value:function(){return this.cards.map(function(e,a){return a})}},{key:"loadCard",value:function(e){e<0||e>this.cards.length||"number"==typeof this.cards[e]&&(this.cards[e]=new i.default(this.params.dialogs[e],this.params,e,this.contentId,this.callbacks))}}]),s}();a.default=d},function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=function(){function t(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}();var i=H5P.jQuery,s=function(){function l(e,a,r,t){var s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};!function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,l),this.card=e,this.params=a||{},this.id=r,this.contentId=t,this.callbacks=s,this.$cardWrapper=i("<div>",{class:"h5p-dialogcards-cardwrap"});var n=i("<div>",{class:"h5p-dialogcards-cardholder"}).appendTo(this.$cardWrapper);return this.$progressText=i("<div>",{class:"h5p-dialogcards-at-progress"}).appendTo(n),this.createCardContent(e).appendTo(n),this}return t(l,[{key:"createCardContent",value:function(e){var a=i("<div>",{class:"h5p-dialogcards-card-content"});this.createCardImage(e).appendTo(a);var r=i("<div>",{class:"h5p-dialogcards-card-text-wrapper"}).appendTo(a),t=i("<div>",{class:"h5p-dialogcards-card-text-inner"}).appendTo(r),s=i("<div>",{class:"h5p-dialogcards-card-text-inner-content"}).appendTo(t);this.createCardAudio(e).appendTo(s);var n=i("<div>",{class:"h5p-dialogcards-card-text"}).appendTo(s);return this.$cardTextArea=i("<div>",{class:"h5p-dialogcards-card-text-area",tabindex:"-1",html:e.text}).appendTo(n),e.text&&e.text.length||n.addClass("hide"),this.createCardFooter().appendTo(r),a}},{key:"createCardImage",value:function(e){this.$image;var a=i("<div>",{class:"h5p-dialogcards-image-wrapper"});return void 0!==e.image?(this.image=e.image,this.$image=i('<img class="h5p-dialogcards-image" src="'+H5P.getPath(e.image.path,this.contentId)+'"/>'),e.imageAltText&&this.$image.attr("alt",e.imageAltText)):this.$image=i('<div class="h5p-dialogcards-image"></div>'),this.$image.appendTo(a),a}},{key:"createCardAudio",value:function(e){if(this.audio,this.$audioWrapper=i("<div>",{class:"h5p-dialogcards-audio-wrapper"}),void 0!==e.audio){var a={files:e.audio,audioNotSupported:this.params.audioNotSupported};this.audio=new H5P.Audio(a,this.contentId),this.audio.attach(this.$audioWrapper),this.audio.audio&&this.audio.audio.preload&&(this.audio.audio.preload="none")}else this.$audioWrapper.addClass("hide");return this.$audioWrapper}},{key:"createCardFooter",value:function(){var e=i("<div>",{class:"h5p-dialogcards-card-footer"}),a="h5p-dialogcards-button-hidden",r="-1";return"repetition"===this.params.mode&&(a="",this.params.behaviour.quickProgression&&(a="h5p-dialogcards-quick-progression",r="0")),this.$buttonTurn=H5P.JoubelUI.createButton({class:"h5p-dialogcards-turn",html:this.params.answer}).appendTo(e),this.$buttonShowSummary=H5P.JoubelUI.createButton({class:"h5p-dialogcards-show-summary h5p-dialogcards-button-gone",html:this.params.showSummary}).appendTo(e),this.$buttonIncorrect=H5P.JoubelUI.createButton({class:"h5p-dialogcards-answer-button",html:this.params.incorrectAnswer}).addClass("incorrect").addClass(a).attr("tabindex",r).appendTo(e),this.$buttonCorrect=H5P.JoubelUI.createButton({class:"h5p-dialogcards-answer-button",html:this.params.correctAnswer}).addClass("correct").addClass(a).attr("tabindex",r).appendTo(e),e}},{key:"createButtonListeners",value:function(){var a=this;this.$buttonIncorrect.unbind("click").click(function(e){e.target.classList.contains("h5p-dialogcards-quick-progression")&&a.callbacks.onNextCard({cardId:a.id,result:!1})}),this.$buttonTurn.unbind("click").click(function(){a.turnCard()}),this.$buttonCorrect.unbind("click").click(function(e){e.target.classList.contains("h5p-dialogcards-quick-progression")&&a.callbacks.onNextCard({cardId:a.id,result:!0})})}},{key:"showSummaryButton",value:function(e){this.getDOM().find(".h5p-dialogcards-answer-button").addClass("h5p-dialogcards-button-hidden").attr("tabindex","-1"),this.$buttonTurn.addClass("h5p-dialogcards-button-gone"),this.$buttonShowSummary.click(function(){return e()}).removeClass("h5p-dialogcards-button-gone").focus()}},{key:"hideSummaryButton",value:function(){"normal"!==this.params.mode&&(this.getDOM().find(".h5p-dialogcards-answer-button").removeClass("h5p-dialogcards-button-hidden").attr("tabindex","0"),this.$buttonTurn.removeClass("h5p-dialogcards-button-gone"),this.$buttonShowSummary.addClass("h5p-dialogcards-button-gone"))}},{key:"turnCard",value:function(){var a=this,r=this.getDOM(),t=r.find(".h5p-dialogcards-card-content"),s=r.find(".h5p-dialogcards-cardholder").addClass("h5p-dialogcards-collapse");t.find(".joubel-tip-container").remove();var n=t.hasClass("h5p-dialogcards-turned");t.toggleClass("h5p-dialogcards-turned",!n),setTimeout(function(){if(s.removeClass("h5p-dialogcards-collapse"),a.changeText(n?a.getText():a.getAnswer()),n?s.find(".h5p-audio-inner").removeClass("hide"):a.removeAudio(s),"repetition"===a.params.mode&&!a.params.behaviour.quickProgression){var e=r.find(".h5p-dialogcards-answer-button");!1===e.hasClass("h5p-dialogcards-quick-progression")&&e.addClass("h5p-dialogcards-quick-progression").attr("tabindex",0)}setTimeout(function(){a.addTipToCard(t,n?"front":"back"),"function"==typeof a.callbacks.onCardTurned&&a.callbacks.onCardTurned(n)},200),a.resizeOverflowingText(),a.$cardTextArea.focus()},200)}},{key:"changeText",value:function(e){this.$cardTextArea.html(e),this.$cardTextArea.toggleClass("hide",!e||!e.length)}},{key:"setProgressText",value:function(e,a){var r=this.params.progressText.replace("@card",e.toString()).replace("@total",a.toString());this.$progressText.html(r)}},{key:"resizeOverflowingText",value:function(){if(this.params.behaviour.scaleTextNotCard){var e=this.getDOM().find(".h5p-dialogcards-card-text"),a=e.children();this.resizeTextToFitContainer(e,a)}}},{key:"resizeTextToFitContainer",value:function(e,a){a.css("font-size","");var r=e.get(0).getBoundingClientRect().height,t=a.get(0).getBoundingClientRect().height,s=parseFloat(e.css("font-size")),n=parseFloat(a.css("font-size")),i=this.getDOM().closest(".h5p-container"),d=parseFloat(i.css("font-size"));if(r<t)for(var o=!0;o;){if((n-=l.SCALEINTERVAL)<l.MINSCALE){o=!1;break}a.css("font-size",n/s+"em"),(t=a.get(0).getBoundingClientRect().height)<=r&&(o=!1)}else for(var c=!0;c;){if(d<(n+=l.SCALEINTERVAL)){c=!1;break}a.css("font-size",n/s+"em"),r<=(t=a.get(0).getBoundingClientRect().height)&&(c=!1,n-=l.SCALEINTERVAL,a.css("font-size",n/s+"em"))}}},{key:"addTipToCard",value:function(e,a,r){"back"!==a&&(a="front"),void 0===r&&(r=this.id),e.find(".joubel-tip-container").remove();var t=this.card.tips;if(void 0!==t&&void 0!==t[a]){var s=t[a].trim();s.length&&e.find(".h5p-dialogcards-card-text-wrapper .h5p-dialogcards-card-text-inner").after(H5P.JoubelUI.createTip(s,{tipLabel:this.params.tipButtonLabel}))}}},{key:"setCardFocus",value:function(e){var a=this;!0===e?this.$cardTextArea.focus():this.getDOM().one("transitionend",function(){a.$cardTextArea.focus()})}},{key:"stopAudio",value:function(){this.audio&&this.audio.stop&&this.audio.stop()}},{key:"removeAudio",value:function(){this.stopAudio(),this.getDOM().find(".h5p-audio-inner").addClass("hide")}},{key:"getDOM",value:function(){return this.$cardWrapper}},{key:"getText",value:function(){return this.card.text}},{key:"getAnswer",value:function(){return this.card.answer}},{key:"getImage",value:function(){return this.$image}},{key:"getImageSize",value:function(){return this.image?{width:this.image.width,height:this.image.height}:this.image}},{key:"getAudio",value:function(){return this.$audioWrapper}},{key:"reset",value:function(){var e=this.getDOM();e.removeClass("h5p-dialogcards-previous"),e.removeClass("h5p-dialogcards-current"),this.changeText(this.getText());var a=e.find(".h5p-dialogcards-card-content");a.removeClass("h5p-dialogcards-turned"),this.addTipToCard(a,"front",this.id),this.params.behaviour.quickProgression||e.find(".h5p-dialogcards-answer-button").removeClass("h5p-dialogcards-quick-progression"),this.hideSummaryButton()}}]),l}();s.SCALEINTERVAL=.2,s.MAXSCALE=16,s.MINSCALE=4,a.default=s},function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=function(){function t(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}();var s=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.cards=r.filter(function(e,a){return r.indexOf(e)>=a}),this}return t(e,[{key:"getCards",value:function(){return this.cards}},{key:"peek",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return a=Math.max(0,a),"top"===e&&(e=0),"bottom"===e&&(e=this.cards.length-a),e<0||e>this.cards.length-1?[]:this.cards.slice(e,e+a)}},{key:"add",value:function(r){var t=this,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top";"number"==typeof r&&(r=[r]),r.forEach(function(e){var a;-1===t.cards.indexOf(e)&&("top"===s?s=0:"bottom"===s?s=t.cards.length:"random"===s&&(s=Math.floor(Math.random()*t.cards.length)),(a=t.cards).splice.apply(a,[s,0].concat(function(e){if(Array.isArray(e)){for(var a=0,r=Array(e.length);a<e.length;a++)r[a]=e[a];return r}return Array.from(e)}(r))))})}},{key:"push",value:function(e){this.add(e,"top")}},{key:"pull",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top";return e=Math.max(1,Math.min(e,this.cards.length)),"top"===a&&(a=0),"bottom"===a&&(a=-e),a=Math.max(0,Math.min(a,this.cards.length-1)),this.cards.splice(a,e)}},{key:"remove",value:function(e){var r=this;"number"==typeof e&&(e=[e]),e.forEach(function(e){var a=r.cards.indexOf(e);-1<a&&r.cards.splice(a,1)})}},{key:"shuffle",value:function(){for(var e=this.cards.length-1;0<e;e--){var a=Math.floor(Math.random()*(e+1)),r=[this.cards[a],this.cards[e]];this.cards[e]=r[0],this.cards[a]=r[1]}return this.cards}},{key:"contains",value:function(e){return-1!==this.cards.indexOf(e)}},{key:"length",value:function(){return this.cards.length}}]),e}();a.default=s},function(e,a,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=function(){function t(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}();var s=function(){function d(e,a){!function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,d),this.params=e,this.callbacks=a,this.currentCallback=a.nextRound,this.fields=[],this.container=document.createElement("div"),this.container.classList.add("h5p-dialogcards-summary-screen");var r=this.createContainerDOM(e.summary);this.fields.round=r.getElementsByClassName("h5p-dialogcards-summary-subheader")[0],this.fields["h5p-dialogcards-round-cards-right"]=this.addTableRow(r,{category:this.params.summaryCardsRight,symbol:"h5p-dialogcards-check"}),this.fields["h5p-dialogcards-round-cards-wrong"]=this.addTableRow(r,{category:this.params.summaryCardsWrong,symbol:"h5p-dialogcards-times"}),this.fields["h5p-dialogcards-round-cards-not-shown"]=this.addTableRow(r,{category:this.params.summaryCardsNotShown});var t=this.createContainerDOM(e.summaryOverallScore);this.fields["h5p-dialogcards-overall-cards-completed"]=this.addTableRow(t,{category:this.params.summaryCardsCompleted,symbol:"h5p-dialogcards-check"}),this.fields["h5p-dialogcards-overall-completed-rounds"]=this.addTableRow(t,{category:this.params.summaryCompletedRounds,symbol:""});var s=document.createElement("div");s.classList.add("h5p-dialogcards-summary-message"),this.fields.message=s;var n=H5P.JoubelUI.createButton({class:"h5p-dialogcards-buttonNextRound",title:this.params.nextRound.replace("@round",2),html:this.params.nextRound.replace("@round",2)}).click(this.currentCallback).get(0);this.fields.button=n;var i=document.createElement("div");return i.classList.add("h5p-dialogcards-summary-footer"),i.appendChild(n),this.container.appendChild(r),this.container.appendChild(t),this.container.appendChild(s),this.container.appendChild(i),this.hide(),this}return t(d,[{key:"getDOM",value:function(){return this.container}},{key:"createContainerDOM",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=document.createElement("div");r.classList.add("h5p-dialogcards-summary-container");var t=document.createElement("div");t.classList.add("h5p-dialogcards-summary-header"),t.innerHTML=e,r.appendChild(t);var s=document.createElement("div");s.classList.add("h5p-dialogcards-summary-subheader"),s.innerHTML=a,r.appendChild(s);var n=document.createElement("table");return n.classList.add("h5p-dialogcards-summary-table"),r.appendChild(n),r}},{key:"addTableRow",value:function(e,a){var r=e.getElementsByClassName("h5p-dialogcards-summary-table")[0],t=document.createElement("tr"),s=document.createElement("td");s.classList.add("h5p-dialogcards-summary-table-row-category"),s.innerHTML=a.category,t.appendChild(s);var n=document.createElement("td");n.classList.add("h5p-dialogcards-summary-table-row-symbol"),void 0!==a.symbol&&""!==a.symbol&&n.classList.add(a.symbol),t.appendChild(n);var i=document.createElement("td");return i.classList.add("h5p-dialogcards-summary-table-row-score"),t.appendChild(i),r.appendChild(t),i}},{key:"update",value:function(){var r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=e.done,t=void 0!==a&&a,s=e.round,n=void 0===s?void 0:s,i=e.message,d=void 0===i?void 0:i,o=e.results,c=void 0===o?[]:o;!0===t?this.params.behaviour.enableRetry?(this.fields.button.classList.remove("h5p-dialogcards-button-next-round"),this.fields.button.classList.add("h5p-dialogcards-button-restart"),this.fields.button.innerHTML=this.params.retry,this.fields.button.title=this.params.retry,this.currentCallback=this.callbacks.retry):this.fields.button.classList.add("h5p-dialogcards-button-gone"):(this.fields.button.classList.add("h5p-dialogcards-button-next-round"),this.fields.button.classList.remove("h5p-dialogcards-button-restart"),this.fields.button.innerHTML=this.params.nextRound,this.fields.button.title=this.params.nextRound,this.currentCallback=this.callbacks.nextRound),H5P.jQuery(this.fields.button).unbind("click").click(this.currentCallback),this.fields.round.innerHTML=this.params.round.replace("@round",n),t||void 0===n||(this.fields.button.innerHTML=this.params.nextRound.replace("@round",n+1),this.fields.button.title=this.params.nextRound.replace("@round",n+1)),t&&void 0!==d&&""!==d?(this.fields.message.classList.remove("h5p-dialogcards-gone"),this.fields.message.innerHTML=d):this.fields.message.classList.add("h5p-dialogcards-gone"),c.forEach(function(e){var a=void 0!==e.score.value?e.score.value:"";void 0!==e.score.max&&(a=a+'&nbsp;<span class="h5p-dialogcards-summary-table-row-score-divider">/</span>&nbsp;'+e.score.max),r.fields[e.field].innerHTML=a})}},{key:"show",value:function(){this.container.classList.remove("h5p-dialogcards-gone"),this.fields.button.focus()}},{key:"hide",value:function(){this.container.classList.add("h5p-dialogcards-gone")}}]),d}();a.default=s}]);