(function(e){function t(o){if(a[o])return a[o].exports;var s=a[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:o})},t.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&'object'==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,'default',{enumerable:!0,value:e}),2&a&&'string'!=typeof e)for(var s in e)t.d(o,s,function(t){return e[t]}.bind(null,s));return o},t.n=function(e){var a=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(a,'a',a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=1)})([function(){},function(e,t,a){'use strict';function o(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function s(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,'value'in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&s(e.prototype,t),a&&s(e,a),e}function r(e){return p(e)||l(e)||i()}function i(){throw new TypeError('Invalid attempt to spread non-iterable instance')}function l(e){if(Symbol.iterator in Object(e)||'[object Arguments]'===Object.prototype.toString.call(e))return Array.from(e)}function p(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function u(e){'@babel/helpers - typeof';return u='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},u(e)}function d(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function c(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,'value'in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function m(e,t,a){return t&&c(e.prototype,t),a&&c(e,a),e}function y(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function T(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,'value'in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function b(e,t,a){return t&&T(e.prototype,t),a&&T(e,a),e}function h(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function S(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,'value'in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function g(e,t,a){return t&&S(e.prototype,t),a&&S(e,a),e}function P(e){'@babel/helpers - typeof';return P='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},P(e)}function N(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function E(e,t){return t&&('object'===P(t)||'function'==typeof t)?t:A(e)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function A(e){if(void 0===e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return e}function _(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function');e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function w(e,t){return w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},w(e,t)}var O=Math.min;a.r(t);var f=a(0),I=function(){function e(t,a){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};o(this,e),this.params=a,this.previousState=s,this.params.audioNotSupported=this.params.audioNotSupported||'Your browser does not support this audio.',this.params.a11y=a.a11y||[],this.params.a11y.play=this.params.a11y.play||'Play',this.params.a11y.playSlowly=this.params.a11y.playSlowly||'Play slowly',this.params.a11y.triesLeft=this.params.a11y.triesLeft||'number of tries left: @number',this.params.a11y.infinite=this.params.a11y.infinite||'infinite',this.params.a11y.sentence=this.params.a11y.sentence||'Sentence',this.params.a11y.solution=this.params.a11y.solution||'Solution',this.params.a11y.enterText=this.params.a11y.enterText||'Enter what you have heard',this.params.type=this.params.type||e.BUTTON_TYPE_NORMAL,this.params.callbacks=this.params.callbacks||{},this.params.callbacks.playAudio=this.params.callbacks.playAudio||function(){},this.triesLeft='undefined'==typeof s.triesLeft?this.params.maxTries:null===s.triesLeft?Infinity:s.triesLeft,this.dom=this.createAudioDOM(t,this.params),null===this.dom.firstChild&&this.dom.appendChild(this.getDummyButtonDOM()),this.status=e.STATUS_ENDED}return n(e,[{key:'createAudioDOM',value:function(t,a){var o=this,s=H5P.jQuery('<div>',{class:e.AUDIO_WRAPPER});if(void 0!==a.sample){var n={files:a.sample,audioNotSupported:a.audioNotSupported},r=new H5P.Audio(n,t,{previousState:this.previousState.audio});r.attach(s),this.button=r.$audioButton.get(0),this.audio=r,a.type===e.BUTTON_TYPE_SLOW?(r.$audioButton.removeClass(e.BUTTON_PLAY).addClass(e.BUTTON_SLOW),this.setLabel(a.a11y.playSlowly)):this.setLabel(a.a11y.play),1>this.triesLeft&&this.audio.disableToggleButton(),this.previousState.audio&&0!==this.previousState.audio.currentTime&&(this.status=e.STATUS_PAUSE,r.$audioButton.addClass(e.BUTTON_PLAY_PAUSED)),r.audio.addEventListener('play',function(){a.type===e.BUTTON_TYPE_SLOW&&r.$audioButton.removeClass(e.BUTTON_SLOW).addClass(e.BUTTON_PAUSE),o.status=e.STATUS_PLAYING,o.params.callbacks.playAudio(o)}),r.audio.addEventListener('pause',function(){a.type===e.BUTTON_TYPE_SLOW&&r.$audioButton.removeClass(e.BUTTON_PAUSE).addClass(e.BUTTON_SLOW),o.status=e.STATUS_PAUSE}),r.audio.addEventListener('ended',function(){o.handlePlayed(),a.type===e.BUTTON_TYPE_SLOW?(r.$audioButton.removeClass(e.BUTTON_PAUSE).addClass(e.BUTTON_SLOW),o.setLabel(o.params.a11y.playSlowly)):o.setLabel(o.params.a11y.play),o.status=e.STATUS_ENDED}),r.audio&&r.audio.preload&&(r.audio.preload='none')}return s.get(0)}},{key:'getDOM',value:function(){return this.dom}},{key:'getDummyButtonDOM',value:function(){var t=document.createElement('div');t.classList.add(e.BUTTON),t.classList.add(e.BUTTON_NONE);var a=document.createElement('div');return a.classList.add(e.INNER_CONTAINER),a.appendChild(t),a}},{key:'play',value:function(){this.status!==e.STATUS_PLAYING&&this.button.click()}},{key:'pause',value:function(){this.status===e.STATUS_PLAYING&&this.button.click()}},{key:'handlePlayed',value:function(){this.triesLeft--,0===this.triesLeft&&this.disable()}},{key:'setLabel',value:function(e){var t=isFinite(this.triesLeft)?this.triesLeft:this.params.a11y.infinite,a=this.params.a11y.triesLeft.replace(/@number/g,t);this.button&&(this.button.setAttribute('aria-label',''.concat(e,'. ').concat(a)),this.button.setAttribute('title',a))}},{key:'reset',value:function(){this.triesLeft=this.params.maxTries,this.audio&&this.audio.seekTo(0),this.status=e.STATUS_ENDED,this.enable(),this.params.type===e.BUTTON_TYPE_SLOW?this.setLabel(this.params.a11y.playSlowly):this.setLabel(this.params.a11y.play)}},{key:'enable',value:function(){this.button&&this.audio.enableToggleButton()}},{key:'setUntabbable',value:function(){this.button&&this.button.setAttribute('tabindex','-1')}},{key:'setTabbable',value:function(){this.button&&this.button.setAttribute('tabindex','0')}},{key:'disable',value:function(){this.button&&this.audio.disableToggleButton()}},{key:'isEnabled',value:function(){return!!this.button&&this.audio.isEnabled()}},{key:'resetAudio',value:function(){this.audio&&this.audio.audio&&this.audio.audio.load&&this.audio.audio.load(),this.button&&(this.button.classList.remove(e.BUTTON_PAUSE),this.button.classList.remove(e.BUTTON_PLAY_PAUSED),this.params.type===e.BUTTON_TYPE_SLOW?this.button.classList.add(e.BUTTON_SLOW):this.button.classList.add(e.BUTTON_PLAY))}},{key:'getCurrentState',value:function(){return{audio:this.audio?this.audio.getCurrentState():void 0,triesLeft:this.triesLeft}}},{key:'focus',value:function(){this.button&&this.button.focus()}}]),e}();I.BUTTON_TYPE_NORMAL=0,I.BUTTON_TYPE_SLOW=1,I.STATUS_PAUSE=0,I.STATUS_PLAYING=1,I.STATUS_ENDED=2,I.AUDIO_WRAPPER='h5p-dictation-audio-wrapper',I.BUTTON='h5p-audio-minimal-button',I.BUTTON_PLAY='h5p-audio-minimal-play',I.BUTTON_PLAY_PAUSED='h5p-audio-minimal-play-paused',I.BUTTON_PAUSE='h5p-audio-minimal-pause',I.BUTTON_SLOW='h5p-audio-minimal-slow',I.BUTTON_NONE='h5p-audio-minimal-none',I.INNER_CONTAINER='h5p-audio-inner';var L=I,k=function(){function e(){d(this,e)}return m(e,null,[{key:'extend',value:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&('object'===u(arguments[0][t])&&'object'===u(arguments[e][t])?this.extend(arguments[0][t],arguments[e][t]):arguments[0][t]=arguments[e][t]);return arguments[0]}},{key:'htmlDecode',value:function(e){var t=new DOMParser().parseFromString(e,'text/html');return t.documentElement.textContent}},{key:'revertRTL',value:function(t){var a=[],o=[];return t.forEach(function(t){var s=e.containsRTLCharacters(t.solution);s?o.push(t):(a=a.concat(o.reverse()),o=[],a.push(t))}),0!==o.length&&(a=a.concat(o.reverse())),a}},{key:'splitWordAlternatives',value:function(e){var t=e.split('').reverse().join(''),a=t.split(/\|(?!\\)/);return a.map(function(e){return e.split('').reverse().join('').replace('\\|','|')}).reverse()}},{key:'containsRTLCharacters',value:function(t){return new RegExp('^[^'+e.RTL+']*?['+e.RTL+']').test(t)}},{key:'buildCombinations',value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:' ',o=[];return e.forEach(function(e){o.push.apply(o,r(t.map(function(t){return''===t?e:''.concat(t).concat(a).concat(e)})))}),o}}]),e}();k.RTL='\u0591-\u08FF';var x=k,C=function(){function e(t){var a=this;y(this,e),this.params=t,this.words=document.createElement('div'),this.words.classList.add(e.SOLUTION_TEXT),this.words.setAttribute('role','list'),this.words.setAttribute('aria-label',this.params.a11y.solution),this.words.setAttribute('aria-expanded','false'),this.words.setAttribute('tabindex','0'),this.words.addEventListener('keydown',function(e){var t=a.words.getAttribute('aria-expanded'),o=a.wordMarked||(a.params.containsRTL?a.words.lastChild:a.words.firstChild);switch(e.keyCode){case 13:case 32:if(e.target!==e.currentTarget)break;'false'===t?(a.words.setAttribute('aria-expanded','true'),o&&o.focus()):(a.words.setAttribute('aria-expanded','false'),o.setAttribute('tabindex','-1'));}}),this.solutionInner=document.createElement('div'),this.solutionInner.classList.add(e.SOLUTION_INNER),this.solutionInner.appendChild(this.words),this.container=document.createElement('div'),this.container.classList.add(e.SOLUTION_CONTAINER),this.container.classList.add(e.HIDE),this.container.appendChild(this.solutionInner)}return b(e,[{key:'getDOM',value:function(){return this.container}},{key:'createSolution',value:function(e){var t=this;return this.params.containsRTL&&(e.words=x.revertRTL(e.words)),e.words.map(function(a,o){return t.createSolutionWordDOM(o,a,e.words.length-1!==o)})}},{key:'createSolutionWordDOM',value:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];'first'===this.params.alternateSolution&&'match'!==t.type&&'typo'!==t.type&&(t.solution=t.solution?x.splitWordAlternatives(t.solution)[0]:'');var o=document.createElement('span');!1===this.params.customTypoDisplay&&'typo'===t.type?o.classList.add('h5p-wrapper-wrong'):o.classList.add('h5p-wrapper-'.concat(t.type)),a&&o.classList.add('h5p-spacer'),o.setAttribute('tabindex','-1'),o.setAttribute('role','listitem'),this.addSolutionWordListeners(o);var s=''.concat(this.params.a11y.item,' ').concat(e+1,'.'),n=this.createAriaExplanation(t),r=this.createAriaScore(t.type);return o.setAttribute('aria-label',''.concat(s,' ').concat(n,' ').concat(r)),this.appendExplanationTo(o,t),o}},{key:'addSolutionWordListeners',value:function(e){var t=this;e.addEventListener('focus',function(e){t.wordMarked=e.target,e.target.setAttribute('tabindex','0')}),e.addEventListener('keydown',function(e){var a=t.params.containsRTL?e.target.parentNode.lastChild:e.target.parentNode.firstChild,o=t.params.containsRTL?e.target.parentNode.firstChild:e.target.parentNode.lastChild;switch(e.keyCode){case 37:case 38:e.preventDefault(),e.target.previousSibling&&(e.target.setAttribute('tabindex','-1'),e.target.previousSibling.focus());break;case 39:case 40:e.preventDefault(),e.target.nextSibling&&(e.target.setAttribute('tabindex','-1'),e.target.nextSibling.focus());break;case 36:e.preventDefault(),e.target!==a&&(e.target.setAttribute('tabindex','-1'),a.focus());break;case 35:e.preventDefault(),e.target!==o&&(e.target.setAttribute('tabindex','-1'),o.focus());}})}},{key:'createAriaExplanation',value:function(e){var t={match:this.params.a11y.correct,wrong:this.params.a11y.wrong,typo:this.params.a11y.typo,missing:this.params.a11y.missing,added:this.params.a11y.added},a=this.makeReadable(e.answer),o='match'===e.type||'typo'===e.type?x.splitWordAlternatives(e.solution).join(' '.concat(this.params.a11y.or,' ')):e.solution,s=this.makeReadable(o),n=''.concat(a).concat(''===a?'':'. ').concat(t[e.type],'.');return('wrong'===e.type||'typo'===e.type||'missing'===e.type)&&(n+=' '.concat(this.params.a11y.shouldHaveBeen,'. ').concat(s,'.')),n}},{key:'makeReadable',value:function(e){return void 0===e?'':e.replace(/\./g,this.params.a11y.period).replace(/!/g,this.params.a11y.exclamationPoint).replace(/\?/g,this.params.a11y.questionMark).replace(/,/g,this.params.a11y.comma).replace(/'/g,this.params.a11y.singleQuote).replace(/["\u201C\u201E]/g,this.params.a11y.doubleQuote).replace(/:/g,this.params.a11y.colon).replace(/;/g,this.params.a11y.semicolon).replace(/\+/g,this.params.a11y.plus).replace(/-/g,this.params.a11y.minus).replace(/\*/g,this.params.a11y.asterisk).replace(/\//g,this.params.a11y.forwardSlash)}},{key:'createAriaScore',value:function(e){var t=-1;if('match'===e?t=0:'typo'==e&&(t*=this.params.typoFactor),0===t)t='';else{var a=-1===t?this.params.a11y.point:this.params.a11y.points;t=''.concat(t,' ').concat(a,'.')}return t}},{key:'appendExplanationTo',value:function(e,t){var a=new H5P.Question.ScorePoints;if('wrong'===t.type||'added'===t.type||'typo'===t.type){var o=document.createElement('span');o.classList.add('h5p-answer-'.concat(t.type)),o.innerHTML=t.answer,e.appendChild(o)}if('added'!==t.type){var s=document.createElement('span');s.classList.add('h5p-solution-'.concat(t.type)),s.innerHTML=t.solution,e.appendChild(s)}if('match'!==t.type){var n=a.getElement(!1);'typo'===t.type&&.5===this.params.typoFactor&&(n.classList.remove('h5p-question-minus-one'),n.classList.add('h5p-question-minus-one-half')),('typo'!==t.type||0<this.params.typoFactor)&&e.appendChild(n)}}},{key:'show',value:function(t){var a=this,o=this.createSolution(t);0<o.length&&'match'===t.words[o.length-1].type?this.words.classList.add('h5p-solution-last-correct'):this.words.classList.remove('h5p-solution-last-correct'),this.words.firstChild||o.forEach(function(t){a.words.appendChild(t),a.container.classList.remove(e.HIDE)})}},{key:'hide',value:function(){for(;this.words.firstChild;)this.words.removeChild(this.words.firstChild);this.container.classList.add(e.HIDE)}},{key:'focus',value:function(){this.words.focus()}},{key:'reset',value:function(){this.wordMarked=void 0,this.words.setAttribute('aria-expanded','false')}}]),e}();C.SOLUTION_CONTAINER='h5p-solution-container',C.SOLUTION_INNER='h5p-solution-inner',C.SOLUTION_TEXT='h5p-solution-text',C.HIDE='hide';var D=function(){function e(t,a,o){var s=this,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};h(this,e),this.index=t,this.params=a,this.contentId=o,this.maxTries=a.tries,this.maxTriesAlternative=a.triesAlternative,this.params.sentence.description=(this.params.sentence.description||'').trim(),this.params.callbacks=this.params.callbacks||{},this.params.callbacks.playAudio=this.params.callbacks.playAudio||function(){},this.solutionText=x.htmlDecode(a.sentence.text).trim(),this.solutionText=a.ignorePunctuation?this.stripPunctuation(this.solutionText):this.solutionText,this.containsRTL='auto'===this.params.overrideRTL?x.containsRTLCharacters(this.solutionText):'on'===this.params.overrideRTL,this.mistakesMax=this.addSpaces(this.solutionText).split(' ').length,this.content=document.createElement('div'),this.content.setAttribute('role','group'),this.content.setAttribute('aria-label',''.concat(a.a11y.sentence,' ').concat(this.index)),this.content.classList.add(e.CONTENT_WRAPPER);var r=document.createElement('div');r.classList.add(e.CONTENT_DESCRIPTION),r.innerHTML=this.params.sentence.description;var i=document.createElement('div');i.classList.add(e.CONTENT_INTERACTION),this.buttonPlayNormal=new L(o,{sample:a.sentence.sample,audioNotSupported:a.audioNotSupported,type:L.BUTTON_TYPE_NORMAL,maxTries:a.tries,a11y:a.a11y,callbacks:{playAudio:function(e){s.params.callbacks.playAudio(e)}}},n.buttonPlayNormal),i.appendChild(this.buttonPlayNormal.getDOM()),!0===this.params.hasAlternatives&&(this.buttonPlaySlow=new L(o,{sample:a.sentence.sampleAlternative,audioNotSupported:a.audioNotSupported,type:L.BUTTON_TYPE_SLOW,maxTries:a.triesAlternative,a11y:a.a11y,callbacks:{playAudio:function(e){s.params.callbacks.playAudio(e)}}},n.buttonPlaySlow),i.appendChild(this.buttonPlaySlow.getDOM())),r.classList.add(!0===this.params.hasAlternatives?e.CONTENT_DESCRIPTION_TWO_BUTTONS:e.CONTENT_DESCRIPTION_ONE_BUTTON),this.inputField=document.createElement('input'),this.inputField.setAttribute('spellcheck','false'),this.inputField.setAttribute('autocorrect','off'),this.inputField.setAttribute('autocapitalize','off'),this.inputField.setAttribute('aria-label',this.params.a11y.enterText),this.inputField.classList.add(e.INPUT_FIELD),n.userInput&&(this.inputField.value=n.userInput),this.solution=new C({alternateSolution:this.params.alternateSolution,customTypoDisplay:this.params.customTypoDisplay,typoFactor:this.params.typoFactor,containsRTL:this.containsRTL,a11y:{match:this.params.a11y.correct,wrong:this.params.a11y.wrong,typo:this.params.a11y.typo,missing:this.params.a11y.missing,added:this.params.a11y.added,correct:this.params.a11y.correct,point:this.params.a11y.point,points:this.params.a11y.points,item:this.params.a11y.item,solution:this.params.a11y.solution,or:this.params.a11y.or,shouldHaveBeen:this.params.a11y.shouldHaveBeen,period:this.params.a11y.period,exclamationPoint:this.params.a11y.exclamationPoint,questionMark:this.params.a11y.questionMark,comma:this.params.a11y.comma,singleQuote:this.params.a11y.singleQuote,doubleQuote:this.params.a11y.doubleQuote,colon:this.params.a11y.colon,semicolon:this.params.a11y.semicolon,plus:this.params.a11y.plus,minus:this.params.a11y.minus,asterisk:this.params.a11y.asterisk,forwardSlash:this.params.a11y.forwardSlash}}),this.inputWrapper=document.createElement('div'),this.inputWrapper.classList.add(e.INPUT_WRAPPER),this.inputWrapper.appendChild(this.inputField),this.inputWrapper.appendChild(this.solution.getDOM()),i.appendChild(this.inputWrapper),this.content.appendChild(r),this.content.appendChild(i)}return g(e,[{key:'getDOM',value:function(){return this.content}},{key:'getUserInput',value:function(){return this.inputField.value}},{key:'showSolution',value:function(e){this.solution.show(e),this.buttonPlayNormal&&this.buttonPlayNormal.setUntabbable(),this.buttonPlaySlow&&this.buttonPlaySlow.setUntabbable()}},{key:'hideSolution',value:function(){this.solution.hide(),this.buttonPlayNormal&&this.buttonPlayNormal.setTabbable(),this.buttonPlaySlow&&this.buttonPlaySlow.setTabbable()}},{key:'getCorrectText',value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];return e?this.addSpaces(this.solutionText).split(' '):this.solutionText}},{key:'getCurrentState',value:function(){return{userInput:this.getUserInput(),buttonPlayNormal:this.buttonPlayNormal?this.buttonPlayNormal.getCurrentState():void 0,buttonPlaySlow:this.buttonPlaySlow?this.buttonPlaySlow.getCurrentState():void 0}}},{key:'getMaxMistakes',value:function(){return this.mistakesMax}},{key:'getXAPIDescription',value:function(){return this.params.sentence.description||''?'<p>'.concat(this.params.sentence.description,'</p>'):''}},{key:'reset',value:function(){this.inputField.value='',this.solution.reset(),this.buttonPlayNormal&&this.buttonPlayNormal.reset(),this.buttonPlaySlow&&this.buttonPlaySlow.reset()}},{key:'disable',value:function(){this.inputField.disabled=!0,this.buttonPlayNormal&&(this.buttonPlayNormal.disable(),this.buttonPlayNormal.resetAudio()),this.buttonPlaySlow&&(this.buttonPlaySlow.disable(),this.buttonPlaySlow.resetAudio())}},{key:'enable',value:function(){this.inputField.disabled=!1,this.buttonPlayNormal&&this.buttonPlayNormal.enable(),this.buttonPlaySlow&&this.buttonPlaySlow.enable()}},{key:'pauseButtons',value:function(e){this.buttonPlayNormal&&this.buttonPlayNormal!==e&&this.buttonPlayNormal.pause(),this.buttonPlaySlow&&this.buttonPlaySlow!==e&&this.buttonPlaySlow.pause()}},{key:'focus',value:function(){this.buttonPlayNormal&&this.buttonPlayNormal.focus()}},{key:'addSpaces',value:function(t){return t=t.replace(new RegExp('('.concat(e.WORD,'|^)(?=').concat(e.PUNCTUATION,')'),'g'),'$1 '),t=t.replace(new RegExp('('.concat(e.PUNCTUATION,')(?=').concat(e.WORD,')'),'g'),'$1 '),!0===this.params.autosplit&&(t=t.replace(new RegExp('('.concat(e.AUTOSPLIT,')(?=').concat(e.AUTOSPLIT,')'),'g'),'$1 '),t=t.replace(new RegExp('('.concat(e.AUTOSPLIT,')(?=').concat(e.WORD,'|d|').concat(e.PUNCTUATION,')'),'g'),'$1 '),t=t.replace(new RegExp('('.concat(e.WORD,'|d|').concat(e.PUNCTUATION,')(?=').concat(e.AUTOSPLIT,')'),'g'),'$1 ')),t.trim()}},{key:'stripPunctuation',value:function(t){var a=!1;'string'==typeof t&&(a=!0,t=[t]);var o=new RegExp(e.PUNCTUATION,'g');return t=t.map(function(e){return e.replace(o,'')}),a?t.toString():t}},{key:'computeResults',value:function(){var t=this.addSpaces(this.getCorrectText()).split(' '),a=this.getUserInput();this.params.ignorePunctuation&&(a=this.stripPunctuation(a));var o=''===a.trim()?[]:this.addSpaces(a).split(' '),s=this.alignWords(t,o),n=this.computeScore(s),r=n.scoreTotal,i=n.words;return{score:{added:r[e.TYPE_ADDED],missing:r[e.TYPE_MISSING],typo:r[e.TYPE_TYPO],wrong:r[e.TYPE_WRONG],match:r[e.TYPE_MATCH],total:O(r[e.TYPE_ADDED]+r[e.TYPE_MISSING]+r[e.TYPE_TYPO]+r[e.TYPE_WRONG],this.getMaxMistakes())},words:i}}},{key:'computeScore',value:function(t){var a=[],o=[];o[e.TYPE_ADDED]=0,o[e.TYPE_MISSING]=0,o[e.TYPE_TYPO]=0,o[e.TYPE_WRONG]=0,o[e.TYPE_MATCH]=0;for(var s=0;s<t.words1.length;s++){var n=t.words1[s],r=t.words2[s],i='';i=void 0===n?e.TYPE_ADDED:void 0===r?e.TYPE_MISSING:r===n?e.TYPE_MATCH:H5P.TextUtilities.areSimilar(n,r)?e.TYPE_TYPO:e.TYPE_WRONG,o[i]++,a.push({solution:n,answer:r,type:i})}return{scoreTotal:o,words:a}}},{key:'alignWords',value:function(e,t){var a=function(e){return e.words1.map(function(t,a){return t===e.words2[a]||H5P.TextUtilities.areSimilar(t,e.words2[a])||!1})},o=function(e,t){var a,o=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];if(void 0!==t){var s=x.splitWordAlternatives(t);return o?s.forEach(function(t){H5P.TextUtilities.areSimilar(t,e)&&(a=a||t)}):s.forEach(function(t){t===e&&(a=a||t)}),a}},s=function(e,t){t=t.map(function(e){return''===e?void 0:e});var a=e.map(function(e){return Array.apply(null,Array(t.length)).concat(e)}).reduce(function(e,t){return e.concat(t)},[]);a=a.concat(Array.apply(null,Array(t.length)));for(var s,n=Array.apply(null,Array(a.length)),r=0,l=0;l<t.length;l++){s=t[l];for(var i=a.length-1;i>=r;i--){var p=o(s,a[i]),u=void 0!==s&&void 0!==p,d=-1===t.slice(l+1).indexOf(s);if(u&&d||i===r){a[i]=p,n[i]=s,r=i+1;break}}}for(var c,m=n.length-1;0<=m;m--)if(c=n[m],void 0!==c&&c!==a[m]){for(var y,T=0,b=0,h=void 0;m+T+1<n.length&&void 0===n[m+T+1];)y=o(c,a[m+T+1]),void 0!==y&&(b=m+T+1,h=y),T++;n[b||m+T]=c,void 0!==h&&(a[b]=h),n[m]=void 0}for(var S,g=0;g<n.length;g++)if(S=n[g],void 0!==S&&S!==a[g]){for(var P,N=0,E=0,v=void 0;0<=g+N-1&&void 0===n[g+N-1];)P=o(S,a[g+N-1],!0),void 0!==P&&(E=g+N-1,v=P),N--;n[E||g+N]=S,void 0!==v&&(a[E]=v),n[g]=void 0}for(var A=a.length-1;0<=A;A--)void 0===a[A]&&void 0===n[A]&&(a.splice(A,1),n.splice(A,1));for(var _=0;_<a.length-1;_++)void 0===a[_]&&void 0===n[_+1]&&(a[_]=a[_+1],a.splice(_+1,1),n.splice(_+1,1));for(var w=0;w<a.length-1;w++)if(n[w]===a[w]&&void 0===a[w+1]){for(var O=0;w+O+1<a.length&&void 0===a[w+O+1];)O++;w+O+1<a.length&&-1!==n.slice(w+1,w+O+1).lastIndexOf(n[w])&&(a[w+O+1]=[a[w]],a[w]=void 0)}a.reverse(),n.reverse();for(var f=0;f<a.length-1;f++)if(n[f]===a[f]&&void 0===a[f+1]){for(var I=0;f+I+1<a.length&&void 0===a[f+I+1];)I++;f+I+1<a.length&&-1!==n.slice(f+1,f+I+1).lastIndexOf(n[f])&&(a[f+I+1]=[a[f]],a[f]=void 0)}return a.reverse(),n.reverse(),{words1:a,words2:n}},n=function(e){return a(e).reduce(function(e,t){return e+(t?1:0)},0)},r=s(e,t),i=s(e.reverse(),t.reverse());n(i)>n(r)&&(r={words1:i.words1.reverse(),words2:i.words2.reverse()});var l=a(r),p=-1,u=l.length-1;do{for(p=l.lastIndexOf(!0,u);void 0===r.words1[p+1]&&void 0===r.words2[u];)r.words1.splice(p+1,1),r.words2.splice(u,1),u-=1;u=p-1}while(0<p);return r}},{key:'focusSolution',value:function(){this.solution.focus()}}]),e}();D.CONTENT_WRAPPER='h5p-sentence',D.CONTENT_DESCRIPTION='h5p-sentence-description',D.CONTENT_DESCRIPTION_ONE_BUTTON='h5p-sentence-description-one-button',D.CONTENT_DESCRIPTION_TWO_BUTTONS='h5p-sentence-description-two-buttons',D.CONTENT_INTERACTION='h5p-sentence-interaction',D.INPUT_WRAPPER='h5p-input-wrapper',D.INPUT_FIELD='h5p-text-input',D.TYPE_ADDED='added',D.TYPE_MISSING='missing',D.TYPE_WRONG='wrong',D.TYPE_MATCH='match',D.TYPE_TYPO='typo',D.AUTOSPLIT='[\u4E00-\u62FF\u6300-\u77FF\u7800-\u8CFF\u8D00-\u9FFF]',D.PUNCTUATION='[.?!,\'";\\:\\-\\(\\)/\\+\\-\\*\u201C-\u201E\u060C\u061F\u05BE\u05C0\u05C3\u05C6\u2026\u2027\u22EF\u3000-\u3002\u3008-\u3011\uFF01\uFF08\uFF09\uFF0C\uFF1A\uFF1B\uFF1F\uFF3B\uFF3D\uFE41\uFE42\uFE4F\uFF5E]',D.WORD='\\w|[\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7-\u060B\u060D-\u061E\u0620-\u08FF]';var R=function(e){function t(e,a,o){var s;if(N(this,t),s=E(this,v(t).call(this,'dictation')),s.params=x.extend({media:{},taskDescription:'Please listen carefully and write what you hear.',sentences:[],behaviour:{alternateSolution:'first',autosplit:!0,enableSolutionsButton:!0,enableRetry:!0,ignorePunctuation:!0,overrideRTL:'auto',tries:Infinity,triesAlternative:Infinity,customTypoDisplay:!0,typoFactor:'50'},l10n:{generalFeedback:'You have made @total mistake(s).',checkAnswer:'Check',tryAgain:'Retry',showSolution:'Show solution',audioNotSupported:'Your browser does not support this audio.'},a11y:{play:'Play',playSlowly:'Play slowly',triesLeft:'Number of tries left: @number',infinite:'infinite',enterText:'Enter what you have heard.',yourResult:'You got @score out of @total points',solution:'Solution',sentence:'Sentence',item:'Item',correct:'correct',wrong:'wrong',typo:'small mistake',missing:'missing',added:'added',shouldHaveBeen:'Should have been',or:'or',point:'point',points:'points',period:'period',exclamationPoint:'exclamation point',questionMark:'question mark',comma:'comma',singleQuote:'single quote',doubleQuote:'double quote',colon:'colon',semicolon:'semicolon',plus:'plus',minus:'minus',asterisk:'asterisk',forwardSlash:'forward slash'}},e),s.params.behaviour.enableSolutionsButton=void 0===e.behaviour.enableSolution||e.behaviour.enableSolution,!e)return E(s);s.contentId=a,s.contentData=o||{},s.sentences=[],!window.MSInputMethodContext||!document.documentMode||s.params.sentences.forEach(function(e,t){e.sample&&'audio/x-wav'===e.sample[0].mime&&(console.warn(''.concat(s.params.a11y.sentence,' ').concat(t+1,': ').concat(s.params.l10n.audioNotSupported)),delete e.sample),e.sampleAlternative&&'audio/x-wav'===e.sampleAlternative[0].mime&&(console.warn(''.concat(s.params.a11y.sentence,' ').concat(t+1,': ').concat(s.params.l10n.audioNotSupported)),delete e.sampleAlternative)});var n=s.params.sentences.some(function(e){return void 0!==e.sampleAlternative});return s.params.behaviour.typoFactor=parseInt(s.params.behaviour.typoFactor)/100,s.params.sentences=s.params.sentences.filter(function(e){return void 0!==e.text&&void 0!==e.sample}).forEach(function(e,t){var a=s.contentData.previousState&&s.contentData.previousState.length>=t+1?s.contentData.previousState[t]:void 0;s.sentences.push(new D(t+1,{sentence:e,audioNotSupported:s.params.l10n.audioNotSupported,tries:s.params.behaviour.tries,triesAlternative:s.params.behaviour.triesAlternative,ignorePunctuation:s.params.behaviour.ignorePunctuation,hasAlternatives:n,a11y:s.params.a11y,customTypoDisplay:s.params.behaviour.customTypoDisplay,typoFactor:s.params.behaviour.typoFactor,alternateSolution:s.params.behaviour.alternateSolution,overrideRTL:s.params.behaviour.overrideRTL,autosplit:s.params.behaviour.autosplit,callbacks:{playAudio:function(e){s.handlePlayAudio(e)}}},s.contentId,a))}),s.maxMistakes=s.sentences.map(function(e){return e.getMaxMistakes()}).reduce(function(e,t){return e+t},0),s.mistakesCapped=0,s.isAnswered=!1,s.registerDomElements=function(){var e=s.params.media.type;if(e&&e.library){var t=e.library.split(' ')[0];'H5P.Image'===t?e.params.file&&s.setImage(e.params.file.path,{disableImageZooming:s.params.media.disableImageZooming,alt:e.params.alt,title:e.params.title}):'H5P.Video'===t&&e.params.sources&&s.setVideo(e)}s.params.taskDescription&&(s.introduction=document.createElement('div'),s.introduction.innerHTML=s.params.taskDescription,s.setIntroduction(s.introduction));var a=document.createElement('div');if(s.sentences.forEach(function(e){a.appendChild(e.getDOM())}),0===s.sentences.length){var o=document.createElement('div');o.classList.add('h5p-dictation-no-content'),o.innerHTML='I really need at least one sound sample and text for it :-)',a.appendChild(o)}s.setContent(a),0!==s.sentences.length&&s.addButtons()},s.addButtons=function(){s.addButton('show-solution',s.params.l10n.showSolution,function(){s.showSolutions(),s.hideButton('show-solution')},!1,{},{}),s.addButton('check-answer',s.params.l10n.checkAnswer,function(){s.showEvaluation(),s.isAnswered=!0,s.triggerXAPI(),s.params.behaviour.enableRetry&&!s.isPassed()&&s.showButton('try-again')},!0,{},{}),s.addButton('try-again',s.params.l10n.tryAgain,function(){s.resetTask(),s.sentences[0].focus()},!1,{},{})},s.handlePlayAudio=function(e){s.sentences.forEach(function(t){t.pauseButtons(e)})},s.showEvaluation=function(){s.computedResults=s.sentences.map(function(e){return e.computeResults()}),s.sentences.forEach(function(e){e.disable()});var e=s.computedResults.map(function(e){return e.score}).reduce(function(e,t){return{added:e.added+t.added,missing:e.missing+t.missing,typo:e.typo+t.typo,wrong:e.wrong+t.wrong,match:e.match+t.match}},{added:0,missing:0,typo:0,wrong:0,match:0}),t=e.added+e.missing+e.wrong+e.typo*s.params.behaviour.typoFactor;s.mistakesCapped=O(t,s.maxMistakes);var a=(s.params.l10n.generalFeedback||'').replace('@added',e.added).replace('@missing',e.missing).replace('@wrong',e.wrong).replace('@typo',e.typo).replace('@matches',e.match).replace('@total',t).replace('@capped',s.mistakesCapped),o=H5P.Question.determineOverallFeedback(s.params.overallFeedback,s.getScore()/s.getMaxScore()),n=s.params.a11y.yourResult.replace('@score',s.getScore()).replace('@total',s.getMaxScore());s.setFeedback(''.concat(a,' ').concat(o).trim(),s.getScore(),s.getMaxScore(),n),s.hideButton('check-answer'),s.params.behaviour.enableSolutionsButton&&s.showButton('show-solution'),s.trigger('resize')},s.isPassed=function(){return 0===s.mistakesCapped},s.getAnswerGiven=function(){return s.isAnswered||s.sentences.some(function(e){return 0<e.getUserInput().length})},s.getScore=function(){return Math.round(s.maxMistakes-s.mistakesCapped)},s.getMaxScore=function(){return s.maxMistakes},s.showSolutions=function(){s.sentences.forEach(function(e,t){e.showSolution(s.computedResults[t])}),s.sentences[0].focusSolution(),s.trigger('resize')},s.resetTask=function(){s.sentences.forEach(function(e){e.reset(),e.enable(),e.hideSolution()}),s.removeFeedback(),s.hideButton('try-again'),s.hideButton('show-solution'),s.showButton('check-answer'),s.introduction?s.introduction.focus():s.sentences[0].focus(),s.mistakesCapped=0,s.isAnswered=!1},s.getXAPIData=function(){return{statement:s.getXAPIAnswerEvent().data.statement}},s.triggerXAPI=function(){s.trigger(s.getXAPIAnswerEvent())},s.getXAPIAnswerEvent=function(){s.computedResults=s.sentences.map(function(e){return e.computeResults()});var e=s.createDictationXAPIEvent('answered'),a=e.getVerifiedStatementValue(['object','definition']);if(a.extensions&&a.extensions[t.XAPI_ALTERNATIVE_EXTENSION]){var o=e.getVerifiedStatementValue(['context']);o.extensions=o.extensions||{},o.extensions[t.XAPI_REPORTING_VERSION_EXTENSION]=t.XAPI_REPORTING_VERSION}e.setScoredResult(s.getScore(),s.getMaxScore(),A(s),!0,s.isPassed());var n=s.computedResults.reduce(function(e,t){return e.concat(t.words.reduce(function(e,t){return e.concat(t.answer||'')},[]))},[]).join('[,]');return e.data.statement.result.response=n,e},s.createDictationXAPIEvent=function(e){var t=s.createXAPIEventTemplate(e);return x.extend(t.getVerifiedStatementValue(['object','definition']),s.getxAPIDefinition()),t},s.getxAPIDefinition=function(){var e=s.computedResults.reduce(function(e,a,o){var n=s.sentences[o].getXAPIDescription(),r=a.words.map(function(){return t.FILL_IN_PLACEHOLDER}).join(' ');return''.concat(e).concat(n,'<p>').concat(r,'</p>')},''),a={};a.name={"en-US":s.getTitle()},a.description={"en-US":''.concat(s.getDescription()).concat(e)},a.type='http://adlnet.gov/expapi/activities/cmi.interaction',a.interactionType='fill-in',a.extensions=a.extensions||{},a.extensions[t.XAPI_CASE_SENSITIVITY]=!0;var o=s.buildCorrectGapVariations();return a.extensions[t.XAPI_ALTERNATIVE_EXTENSION]=o,a.correctResponsesPattern=s.buildxAPICRP(o.slice()),a},s.buildCorrectGapVariations=function(){return s.computedResults.reduce(function(e,t){return e.concat(t.words.map(function(e){return e.solution?e.solution.split('|'):[]}))},[])},s.buildxAPICRP=function(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],a=[''];return e?(t?(e.forEach(function(e){a=x.buildCombinations(e,a,'[,]')}),a=a.map(function(e){return'{case_matters=true}'.concat(e)})):(a=e.map(function(e){return e[0]}).join('[,]'),a=['{case_matters=true}'.concat(a)]),a):a},s.getCurrentState=function(){return s.sentences.map(function(e){return e.getCurrentState()})},s.getTitle=function(){var e;return s.contentData&&s.contentData.metadata&&(e=s.contentData.metadata.title),e=e||t.DEFAULT_DESCRIPTION,H5P.createTitle(e)},s.getDescription=function(){return s.params.taskDescription||t.DEFAULT_DESCRIPTION},s}return _(t,e),t}(H5P.Question);R.DEFAULT_DESCRIPTION='Dictation',R.XAPI_ALTERNATIVE_EXTENSION='https://h5p.org/x-api/alternatives',R.XAPI_CASE_SENSITIVITY='https://h5p.org/x-api/case-sensitivity',R.XAPI_REPORTING_VERSION_EXTENSION='https://h5p.org/x-api/h5p-reporting-version',R.XAPI_REPORTING_VERSION='1.0.0',R.FILL_IN_PLACEHOLDER='__________';H5P=H5P||{},H5P.Dictation=R}]);